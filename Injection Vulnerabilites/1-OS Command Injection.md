---
tags:
  - injection
---
---

# ๐ฏ **Command Injection โ ุญูู ุงูุฃูุงูุฑ**
---

## ๐ก **ุงููุตู**

ูุฌูู Command Injection ูู ููุน ูู ุฃููุงุน ุงููุฌูุงุช ุงููุฏู ููู ุฅู ุงูููุงุฌู ูุดุบู ุฃูุงูุฑ ุนูู ูุธุงู ุงูุชุดุบูู ููุณู (OS) ุนู ุทุฑูู ุชุทุจูู ููู ุซุบุฑุฉ.

ุงูุซุบุฑุฉ ุจุชุญุตู ููุง ุงูุชุทุจูู ูุจุนุช ุจูุงูุงุช ุงููุณุชุฎุฏู (ุฒู ุงูููุฑูุ ุงูููููุฒุ ุฃู ุงูู HTTP headers) ุจุดูู ุบูุฑ ุขูู ููู shell ุจุชุงุน ุงููุธุงู (ุฒู /bin/sh).  
ูู ุงูุญุงูุฉ ุฏูุ ุงููุงูุฑ ููุฏุฑ ูุถูู ุฃูุงูุฑ ูููุธุงู ุชุชููุฐ ุจุณุทุญูุฉ ุฌุฏูุงุ ูููุงู ูููู ุชุชููุฐ ุจุตูุงุญูุงุช ุงูุชุทุจูู ุงููู ููู ุงูุซุบุฑุฉ.

ุงูุซุบุฑุฉ ุฏู ุจุชุญุตู ุบุงูุจูุง ุจุณุจุจ ุฅู ูููุด ุชุญูู ูุงูู ูู ุงูุจูุงูุงุช ุงููู ุฌุงูุฉ ูู ุงููุณุชุฎุฏู.

ุงููุฑู ุจูู Command Injection ู Code Injectionุ

- Code Injection: ุงูููุงุฌู ุจูุถูู ููุฏ ูุดุชุบู ุฌูู ุงูุชุทุจูู ููุณู.
- Command Injection: ุงูููุงุฌู ุจููุณูุน ูุธููุฉ ุงูุชุทุจูู ูุจูุฎููู ูุดุบูู ุฃูุงูุฑ ุนูู ุงููุธุงูุ ูู ุบูุฑ ูุง ูุญูู ููุฏ ุฌุฏูุฏ.

---

## ๐งช **ุฃูุซูุฉ**

### ๐ธ **ูุซุงู 1:**

ููุฏ ุจูุณุชุฎุฏู ุฃูุฑ `cat` ุนุดุงู ูุทุจุน ูุญุชูู ููู:

```c
#include <stdio.h>
#include <unistd.h>

int main(int argc, char **argv) {
 char cat[] = "cat ";
 char *command;
 size_t commandLength;

 commandLength = strlen(cat) + strlen(argv[1]) + 1;
 command = (char *) malloc(commandLength);
 strncpy(command, cat, commandLength);
 strncat(command, argv[1], (commandLength - strlen(cat)) );

 system(command);
 return (0);
}
```

๐ ุงูุงุณุชุฎุฏุงู ุงูุนุงุฏู:

```bash
$ ./catWrapper Story.txt
When last we left our heroes...
```

ููู ูู ุงููุงูุฑ ูุชุจ:

```bash
$ ./catWrapper "Story.txt; ls"
```

ููุทุจุน ุงููููุ ูุจุนุฏูู ูุดุบูู ุฃูุฑ `ls` ููุนุฑุถ ูู ุงููููุงุช! ููู ุงูุจุฑูุงูุฌ ุจูุดุชุบู ุจุตูุงุญูุงุช ุนุงููุฉุ ูููู ูุดุบูู ุฃูุงูุฑ ุฎุทูุฑุฉ ุจููุณ ุงูุตูุงุญูุงุช ๐จ

---

### ๐ธ **ูุซุงู 2:**

ุจุฑูุงูุฌ ุจุณูุท ุจูุงุฎุฏ ุงุณู ููู ูู ุงููุณุชุฎุฏู ููุนุฑุถ ูุญุชูุงู. ูุงูุจุฑูุงูุฌ ูุนููู ุฅูู ูุดุชุบู ุจู `setuid root`.

```c
int main(char* argc, char** argv) {
 char cmd[CMD_MAX] = "/usr/bin/cat ";
 strcat(cmd, argv[1]);
 system(cmd);
}
```

ูู ุงููุงูุฑ ูุชุจ:

```
;rm -rf /
```

ุงูุจุฑูุงูุฌ ุจุฏู ูุง ูุดุบู catุ ููุดุบูู ุฃูุฑ ุญุฐู ุฌุฐูุฑ ุงููุธุงู ุจุงููุงูู ๐คฏ

---

### ๐ธ **ูุซุงู 3:**

ุจุฑูุงูุฌ ุจูุงุฎุฏ ูุณุงุฑ ูู environment variable ุงุณูู `APPHOME` ููุดุบูู ุณูุฑูุจุช ูู ุงููุณุงุฑ ุฏู:

```c
char* home=getenv("APPHOME");
char* cmd=(char*)malloc(strlen(home)+strlen(INITCMD));
if (cmd) {
 strcpy(cmd,home);
 strcat(cmd,INITCMD);
 execl(cmd, NULL);
}
```

ุงููุงูุฑ ููุฏุฑ ูุนุฏู ูููุฉ `APPHOME` ุชุฎูู ุงูุจุฑูุงูุฌ ูุดุบูู ุณูุฑูุจุช ุถุงุฑ ุจุฏู ุงูุณูุฑูุจุช ุงูุญููููุ ููุชููุฐ ุจุตูุงุญูุงุช ุนุงููุฉ.

---

### ๐ธ **ูุซุงู 4:**

ุจุฑูุงูุฌ CGI ุจูุดุบูู ุฃูุฑ `make` ูุชุญุฏูุซ ุงูุจุงุณูุฑุฏ ูู `/var/yp`:

```c
system("cd /var/yp && make &> /dev/null");
```

ุฑุบู ุฅู ุงูุฃูุฑ ููุง ุซุงุจุช ููููููุด ุฅุฏุฎุงู ูู ุงููุณุชุฎุฏูุ ุงููุงูุฑ ููุฏุฑ ูุนุฏู ูุชุบูุฑ ุงูุจูุฆุฉ `$PATH` ููุญุท ููู ูุณุฎุฉ ุฎุจูุซุฉ ูู `make`.  
ูุจูุง ุฅู ุงูุจุฑูุงูุฌ `setuid root`ุ ุงููุณุฎุฉ ุฏู ูุชุดุชุบู ูู root ๐ฌ

---

### ๐ธ **ูุนูููุฉ ุฌุงูุจูุฉ ุนู Java:**

ูุงุณ ูุชูุฑ ุจุชููู ุฅู `Runtime.exec` ูู Java ุฒู `system()` ูู Cุ ูุฏู **ูุด ุตุญ**.

- `system()` ุจูุจุนุช ุงูุฃูุฑ ููุดู ุจุงููุงููุ ูุนูู ุชูุฏุฑ ุชูุชุจ `;`, `|`, `&&`, ุฅูุฎ.
    
- ุฃูุง `Runtime.exec()` ูู Javaุ ุจููุตู ุงูุฃูุฑ ููููุงุช ูุจูุดุบูู ุฃูู ูุงุญุฏุฉ ุจุณ ูุฃูุฑ ูุงูุจุงูู ูู args.
    

ูุนูู ุงูุญุงุฌุงุช ุงููู ุจุชุดุชุบู ูู ุงูุดู ูุด ูุชุดุชุบู ููุง ุจููุณ ุงูุทุฑููุฉ.

---

### ๐ธ **ูุซุงู 5:**

#### โ C:

```c
#include <stdlib.h>
#include <stdio.h>
#include <string.h>

int main(int argc, char **argv)
{
     char command[256];

     if(argc != 2) {
          printf("Error: Please enter a program to time!\n");
          return -1;
     }

     memset(&command, 0, sizeof(command));
     strcat(command, "time ./");
     strcat(command, argv[1]);

     system(command);
     return 0;
}
```

ูู ุญุฏ ูุชุจ:

```
ls; cat /etc/shadow
```

ููุนุฑุถ ุงููููุงุช ูุจุนุฏูู ูุนุฑุถ ุจูุงูุงุช ุญุณุงุณุฉ ุฌุฏูุง.

---

#### โ Java:

ููุณ ุงูููุทุฉ:

- `Runtime.exec()` ูุด ุฒู `system()`ุ
    
- ูุด ุจูุดุบูู ุงูุดูุ ูู ุงูุฃูุงูุฑ ุงููุฑูุจุฉ ุฃู redirect ูุด ูุชุดุชุบู.
    

---

### ๐ธ **ูุซุงู 6: PHP**

```php
<?php
print("Please specify the name of the file to delete");
print("<p>");
$file=$_GET['filename'];
system("rm $file");
?>
```

ุทูุจ URL ุฒู ุฏู:

```
http://127.0.0.1/delete.php?filename=bob.txt;id
```

ููููุฐ `rm bob.txt` ูุจุนุฏูู `id`:

**ุงูุฑุฏ ููููู:**

```
Please specify the name of the file to delete
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

---

## ๐งผ **ุชูุถูู ุงูุฅุฏุฎุงู (Sanitizing Input)**

- ุงููุน ุงูุฑููุฒ ุงูุฎุทูุฑุฉ ุฒู `;`, `&&`, `|`
- ุงุณุชุฎุฏู whitelist ููุญุฑูู ุงููุณููุญุฉ
- ุงุจุนุฏ ุนู ุชูููุฐ ุฃูุงูุฑ ุจุงููุต

---

## โ **ุงูุญูุงูุฉ (Related Controls)**

- ูู ูู API ููุฌูุฏ ูููุธููุฉุ ุงุณุชุฎุฏูู ุจุฏู shell.  
    ูุซุงู:  
    ูู Java ุงุณุชุฎุฏู `javax.mail.*` ุจุฏู `Runtime.exec("mail")`.
- ูู ูุถุทุฑ ุชุณุชุฎุฏู ุฃูุฑุ ูุงุฒู ุชูุธู ูู input ูู ุงููุณุชุฎุฏู ููู ุฌุฏูุง.

---

